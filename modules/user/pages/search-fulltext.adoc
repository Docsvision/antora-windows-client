= Полнотекстовый поиск

Если полнотекстовый поиск xref:dev@platform:console:search-full-text.adoc[включён администратором], его можно использовать из "xref:interface-search-area.adoc[области поиска]" в интерфейсе {wincl}а.

Когда в область поиска введён текст, система ищет среди проиндексированных карточек те, которые содержат введённый текст.

.В {wincl}е поиск может производиться в разных режимах:
* *_В текущей папке_* (подсказка `Поиск в текущей папке...`) -- поиск будет выполнен только в той папке, в которой пользователь находится на момент выполнения поискового запроса:
+
** Когда пользователь переходит в _стандартную_ папку (или делегат на неё) и вводит запрос в строку поиска, полнотекстовый поиск будет выполняться только среди карточек, находящихся в этой папке, независимо от постраничного вывода.
** Когда пользователь переходит в _виртуальную_ папку, сначала будет выполнен настроенный для неё поисковый запрос. Затем, после ввода искомого текста в строку поиска, полнотекстовый поиск будет выполняться только среди карточек, найденных ранее по запросу для папки.
+
* *_Включая подпапки_* (подсказка `Поиск в текущей папке с учетом подпапок...`) -- поиск будет выполнен в текущей папке и её подпапках. Режим доступен, если у текущей папки (независимо от её типа) есть дочерние папки и среди них есть хотя бы одна _стандартная_ подпапка.
+
Если все дочерние папки _виртуальные_, режим будет недоступен. Если в качестве дочерних смешанный набор _виртуальных_, _стандартных_ и _папок-делегатов_, при поиске будут учитываться только _стандартные_ папки и _делегаты_ на них.
+
При переходе к папке, не попадающей под условия, режим будет изменён на _в текущей папке_.
+
* *_Искать в найденном_* (подсказка `Поиск по результатам предыдущего поискового запроса...`) -- поиск будет выполнен среди значений, которые были найдены в результате выполненного поискового запроса.
* *_Везде_* (подсказка `Поиск по всем данных {dv}...`) -- поиск среди всех карточек системы.

[WARNING]
====
Результаты полнотекстового поиска в режимах *_В текущей папке_* и *_Включая подпапки_* не отображаются, когда в свойствах папки, по которой выполняется поиск, снят флаг `*Разрешить обновление при переходе в папку*`.
====

Область поиска выбирается пользователем из числа доступных вариантов в выпадающем списке области поиска. При изменении режима поиска текст запроса не очищается.

По умолчанию используется режим `*В текущей папке*`. Для системных папок _Карточки_, _Конструкторы и справочники_, _Папки_ и _Корзина_ доступен единственный режим поиска _Везде_. Если при поиске был выбран другой режим, при переходе в системные папки он будет автоматически изменён на _Везде_, значение поисковой строки при этом очищено не будет.

Также полнотекстовый поиск может выполняться по значениям полей, выбранных из базовых справочников системы. В последнем случае при поиске учитывается первый уровень ссылок.

При выполнении поиска доступна функция автозаполнения поисковой строки. Количество сохраняемых в приложении поисковых запросов настраивает администратор в справочнике xref:admin:system-settings.adoc#saved-searches[Системные настройки] в разделе menu:{wincl}[Настройки поиска].

.Выбор сохранённого поискового запроса в строке поиска
image::select-saved-query.png[Выбор сохранённого поискового запроса в строке поиска]

Чтобы подтвердить предлагаемый вариант, нажмите клавишу kbd:[↓] на клавиатуре. Ранее использованные фразы в выпадающем списке сортируются по дате их последнего использования: недавние запросы отображаются первыми. +
Предложения основаны на популярных запросах, которые были произведены ранее текущим пользователем. Список вариантов будет индивидуальным для каждого пользователя.

.Чтобы выбрать предпочтительный вариант полнотекстового поиска:
. В области полнотекстового поиска нажмите на кнопку image:buttons/double-check.png[Двойная галочка].
+
.Настройки полнотекстового поиска
image::search-fulltex-settings.png[Настройки полнотекстового поиска]
+
. В окне _Настройки полнотекстового поиска_ найдите группу настроек _Область поиска_ и установите переключатель в положение, соответствующее предпочтительному варианту поиска:
+
* *Искать в тексте карточек или связанных с ними файлов* -- поиск будет производиться по совпадениям строк, в тексте карточек или в тексте вложенных файлов.
+
Также в результаты поиска попадут карточки, в которых строки будут найдены одновременно в карточках и файлах.
+
Данный вариант настроен для использования по умолчанию.
+
* *Искать в тексте карточек* -- поиск не будет производиться по связанным файлам, но будет производиться по ссылочным полям справочников.
* *Искать в тексте файлов* -- поиск производится только по тексту связанных файлов.
* *Искать файлы по имени и размеру* -- поиск производится только по атрибутам файлов, но не по их содержанию.
+
. В группе настроек _Типы карточек_ можно изменить значение системной настройки полнотекстового поиска, задающей ограничение на поиск карточек определённых типов или видов.
+
[NOTE]
====
* Ограничение на полнотекстовый поиск по типу или виду карточки xref:engineer::search-restrict.adoc#by-types[задаётся администратором] в справочнике _Системные настройки_ для всех пользователей {wincl}а.

* Если администратор настроил запрет на персональное изменение данной системной настройки, область _Типы карточек_ в окне _Настройки полнотекстового поиска_ у пользователей будет не активна.

* Настройки ограничений типов карточек в _РМА_ и {wincl}е независимы и не оказывают влияния друг на друга.
====
+
.Настройте персональные ограничения по типам карточек, которые попадут в результаты полнотекстового поиска:
* *Искать среди карточек всех типов* -- полнотекстовый поиск будет выполняться среди всех карточек, без ограничений по типу.
+
Данный способ поиска используется по умолчанию.
+
* *Искать среди типов карточек, указанных администратором* -- полнотекстовый поиск будет выполняться в соответствии с настройками, заданными администратором в справочнике _Системные настройки_.
* *Искать среди карточек указанных типов* -- полнотекстовый поиск будет выполняться только среди карточек определённых типов или видов. Доступные типы или виды карточек отображаются в поле, которое становится активным при выборе данной настройки.
+
Данные настройки являются персональными, и не связаны с настройками, заданными администратором в справочнике _Системные настройки_. Чтобы удалить персональные настройки и восстановить системные настройки, нажмите кнопку *Сброс*.
+
Изменения будут сохранены в профиль пользователя.
+
Если из _{wincl}а_ будет выполнен поисковый запрос, созданный и сохранённый в _РМА_, то ограничения, заданные в этом запросе, будут учитываться как в _РМА_, так и в _{wincl}е_ независимо от настроек последнего.
+
Для обычных, не сохранённых запросов, пользовательские настройки ограничений будут действовать только в том приложении, из которого выполняется поисковый запрос.
+
Полнотекстовый поиск может быть запущен из диалога атрибутивного запроса, совмещенного с полнотекстовым. В таком случае поиск будет выполняться только по типам карточек, указанным в настройках параметрического запроса (см. подробнее в разделе "xref:engineer::search-restrict.adoc#by-types[Установка ограничения поиска по типам карточек]" руководства по настройке).
+
Настройки из профиля пользователя и/или справочника _Системных настроек_ в этом случае не учитываются.
+
. Чтобы результаты полнотекстового поиска были отфильтрованы в зависимости от свойств файлов, приложенных к искомым карточкам, установите флаг `*Использовать параметры поиска файлов*`.
+
Будет активирована соответствующая группа настроек.
+
. В поле _Маска файла_ определите маску файла (имя и расширение).
. В поле _Дата изменения_ выберите один из вариантов:
+
* *_Любая_*.
* *_Пользовательская_* -- позволяет указать диапазон дат.
+
При выборе данного значения становятся активными поля для ввода исходной и конечной даты интервала.
+
. В поле _Размер файла_ укажите размер файла, равный, меньший или больший заданному значению в килобайтах.
. Нажмите на кнопку *ОК*.
+
Настройки полнотекстового поиска для каждого пользователя должны быть сохранены между сессиями {wincl}а. Тогда настройки сохранятся при перезапуске приложения.
+
Результаты полнотекстового поиска будут выводиться с учетом сделанных настроек.
+
. В _Области поиска_ нажмите кнопку в правой части поля и выберите предпочтительный режим поиска.
+
Если последним использованным режимом был *_Искать в найденном_* или *_Включая подпапки_*, при последующих запусках {wincl}а будет установлен режим по умолчанию *_В текущей папке_*.
+
.Выбор режима полнотекстового поиска
image::fulltext-area.png[Выбор режима полнотекстового поиска]
+
. Введите искомый текст в _Область поиска_.
. Нажмите кнопку image:buttons/find-in-view.png[Таблица с лупой].
+
Для режимов *_В текущей папке_*, *_Включая подпапки_* и *_Искать в найденном_* результаты будут отображены в той же папке (независимо от её типа), откуда был запущен поиск. Для вывода результатов будет использоваться представление исходной папки.
+
Для режима *_Везде_* результаты будут отображены в системной папке "xref:interface-navigation-area.adoc#search-results[Результаты поиска]" с представлением *Дайджест*.
+
. Чтобы очистить запрос, воспользуйтесь кнопкой image:buttons/x-red-small.png[Красный крестик].
+
****
include::partial$excerpts.adoc[tags=elastic]

Также от выбора системы полнотекстового поиска зависит возможность поиска по различным типам файлов:

* При использовании встроенной в {mssql} Server системы поиска: `.pdf` и файлы Microsoft Office (`.docx`, `.doc`, `.xlsx`, `.xls`, `.pptx`, `.ppt`, `.rtf`).
* При использовании системы полнотекстового поиска "Elasticsearch": `.pdf`, файлы Microsoft Office (`.docx`, `.doc`, `.xlsx`, `.xls`, `.pptx`, `.ppt`, `.rtf`), `.html` и `.txt`.
****
